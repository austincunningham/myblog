{"version":3,"sources":["webpack:///./src/markdown/2023/openshiftpostgresql.md?7a71","webpack:///./src/markdown/2023/openshiftpostgresql.md"],"names":["render","_vm","this","_h","$createElement","_self","_c","_m","staticRenderFns","_v","attrs","pre","script","component"],"mappings":"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","file":"js/chunk-2d0df80b.5d2315ff.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',[_c('h1',[_vm._v(\"Upgrading Postgresql-v10 to v13 on Openshift\")]),_c('p',[_c('img',{attrs:{\"src\":\"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/k42vumrw4xmdzhumwlig.png\",\"alt\":\"\"}})]),_c('p',[_vm._v(\"On Openshift v4 cluster I am looking to upgrade Postgresql-v10 to Postgersql-V13. For the sake of this blog I will spin up a Posgresql-v10 first via the Openshift templates\")]),_c('p',[_c('img',{attrs:{\"src\":\"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rgywm33xr78g12q1nkxq.gif\",\"alt\":\"create a postgresql v10 via Openshift templates\"}})]),_c('blockquote',[_c('p',[_c('strong',[_vm._v(\"NOTE:\")]),_vm._v(\" I am using quay.io registry here, you can use the \"),_c('a',{attrs:{\"href\":\"https://catalog.redhat.com/software/containers/search?q=postgresql&p=1\"}},[_vm._v(\"Red Hat certified images\")]),_vm._v(\" also\")])]),_c('p',[_vm._v(\"Can we just change the image in the deploymentConfig to \"),_c('code',{pre:true},[_vm._v(\"quay.io/centos7/postgresql-13-centos7\")]),_vm._v(\" ?\")]),_c('p',[_vm._v(\"Unfortunately your postgresql pod will crash with the following error\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"Incompatible data directory. This container image provides\\nPostgreSQL \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'13'\")]),_vm._v(\", but data directory is of\\nversion \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'10'\")]),_vm._v(\".\\nThis image supports automatic data directory upgrade from\\n\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'12'\")]),_vm._v(\", please _carefully_ consult image documentation\\nabout how to use the \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'$POSTGRESQL_UPGRADE'\")]),_vm._v(\" startup option.\\n\")])]),_c('p',[_vm._v(\"This does give us a hit on how to solve the issue but it looks like we need to upgrade through the versions of Postgresql. After a bit of reading about \"),_c('a',{attrs:{\"href\":\"https://catalog.redhat.com/software/containers/rhel8/postgresql-12/5db133bd5a13461646df330b\"}},[_vm._v(\"$POSTGRESQL_UPGRADE\")]),_vm._v(\" we have two options for this env var, \"),_c('strong',[_vm._v(\"copy\")]),_vm._v(\" and \"),_c('strong',[_vm._v(\"hardlink\")]),_vm._v(\". Using \"),_c('strong',[_vm._v(\"copy\")]),_vm._v(\" seems to be the lowest risk upgrade. I  found we can go from\")]),_c('ul',[_c('li',[_vm._v(\"Postgresql 10 - 12\")]),_c('li',[_vm._v(\"Postgresql 12 - 13\")])]),_c('blockquote',[_c('p',[_c('strong',[_vm._v(\"NOTE:\")]),_vm._v(\" $POSTGRESQL_UPGRADE does come with the usually warnings about backing up your data before upgrading your DB. And you should be comfortable with restoring from a back up.\")])]),_c('h2',[_vm._v(\"Postgresql 10 to 12\")]),_c('p',[_vm._v(\"Before we can patch the deployment config image we need to remove the imageChange deployment config trigger as it will revert any image change\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# remove all\")]),_vm._v(\"\\noc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"set\")]),_vm._v(\" triggers dc/postgresql --remove-all\\n\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# add back in the config change trigger\")]),_vm._v(\"\\noc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"set\")]),_vm._v(\" triggers dc/postgresql --from-config\\n\")])]),_c('p',[_vm._v(\"We can then patch the image in the deployment config to v12 \"),_c('code',{pre:true},[_vm._v(\"quay.io/centos7/postgresql-12-centos7\")]),_vm._v(\" with this ugly one-liner patch command\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"oc patch dc postgresql -n postgresql-test --\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"type\")]),_vm._v(\"=\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'json'\")]),_vm._v(\" -p=\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'[{\\\"op\\\": \\\"replace\\\", \\\"path\\\": \\\"/spec/template/spec/containers/0/image\\\", \\\"value\\\":\\\"quay.io/centos7/postgresql-12-centos7\\\"}]'\")]),_vm._v(\"\\n\")])]),_c('p',[_vm._v(\"This will cause a new roll out.\")]),_c('blockquote',[_c('p',[_c('strong',[_vm._v(\"NOTE:\")]),_vm._v(\" I use a lot of cli commands as I am looking to eventually automate this in a script. You can also achieved the same by manually editing the image in the deploymentConfig.\")])]),_c('p',[_vm._v(\"The roll out will have a pod in crashloopbackoff due to not having the \"),_c('code',{pre:true},[_vm._v(\"$POSTGRESQL_UPGRADE\")]),_vm._v(\" env var set. We can  set the environment variable in the deploymentConfig with the following command\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"oc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"set\")]),_vm._v(\" env dc/postgresql -n postgresql-test POSTGRESQL_UPGRADE=copy\\n\")])]),_c('p',[_vm._v(\"This will cause another roll out. Occasionally I found that this upgrade can fail with the following error\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"pg_ctl: another server might be running; trying to start server anyway\\nwaiting \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-keyword\"}},[_vm._v(\"for\")]),_vm._v(\" server to start....2023-02-03 14:14:21.615 UTC [45] FATAL:  lock file \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"\\\"postmaster.pid\\\"\")]),_vm._v(\" already exists\\n\")])]),_c('p',[_vm._v(\"So the long and the short of it is there is a lock file in place in postgresql and we need to shut down the postgresql service correctly to remove it. I ran the following commands before I set the \"),_c('code',{pre:true},[_vm._v(\"$POSTGRESQL_UPGRADE\")]),_vm._v(\" env var.\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# get the non deployment pod name\")]),_vm._v(\"\\nPOD=$(oc get po --all-namespaces | grep \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"\\\"postgresql-\\\"\")]),_vm._v(\" | awk \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'{print $2}'\")]),_vm._v(\" | grep -wv deploy)\\n\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# first stop the postgres service note the paths used in the commands the postgresql database name 'userdata' in this case\")]),_vm._v(\"\\noc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"exec\")]),_vm._v(\" -it \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-variable\"}},[_vm._v(\"$POD\")]),_vm._v(\" -c postgresql -n postgresql-test -- /usr/bin/pg_ctl stop -D /var/lib/pgsql/data/userdata\\n\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# then remove the lock file to be sure\")]),_vm._v(\"\\noc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"exec\")]),_vm._v(\" -it \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-variable\"}},[_vm._v(\"$POD\")]),_vm._v(\" -c system-postgresql -n \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-variable\"}},[_vm._v(\"$THREESCALE_NS\")]),_vm._v(\"  -- rm /var/lib/pgsql/data/userdata/postmaster.pid\\n\")])]),_c('p',[_vm._v(\"I found that once the upgrade is finished the \"),_c('code',{pre:true},[_vm._v(\"$POSTGRESQL_UPGRADE\")]),_vm._v(\" env var being set can cause some problems with future roll outs of the deploymentConfig e.g.\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"== WARNING!! ==\\nPostgreSQL server version matches the datadir PG_VERSION.\\nThe \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-variable\"}},[_vm._v(\"$POSTGRESQL_UPGRADE\")]),_vm._v(\" makes no sense and you probably\\nmade some mistake, keeping the variable \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"set\")]),_vm._v(\" you might\\nrisk a data loss \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-keyword\"}},[_vm._v(\"in\")]),_vm._v(\" future!\\n===============\\n\")])]),_c('p',[_vm._v(\"So we must unset the \"),_c('code',{pre:true},[_vm._v(\"$POSTGRESQL_UPGRADE\")]),_vm._v(\" env var\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"oc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"set\")]),_vm._v(\" env dc/postgresql -n postgresql-test POSTGRESQL_UPGRADE-\\n\")])]),_c('p',[_vm._v(\"This will cause another roll out and that will be stable with v12 installed. To confirm the upgrade was successful you can run the following command\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# run a postgres -V on the pod for postgresql, command finds the only pod that is not the deploy pod\")]),_vm._v(\"\\noc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"exec\")]),_vm._v(\" -it $(oc get po --all-namespaces | grep \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"\\\"postgresql-\\\"\")]),_vm._v(\" | awk \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'{print $2}'\")]),_vm._v(\" | grep -wv deploy) -n postgresql-test -- postgres -V\\n\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# should give you the version\")]),_vm._v(\"\\npostgres (PostgreSQL) 12.7\\n\")])]),_c('h2',[_vm._v(\"Postgresql 12 to 13\")]),_c('p',[_vm._v(\"We can apply the same steps again for 12 to 13. First patch the image in the deploymentConfig to \"),_c('code',{pre:true},[_vm._v(\"quay.io/centos7/postgresql-13-centos7\")]),_vm._v(\" again with the patch command\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"oc patch dc postgresql -n postgresql-test --\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"type\")]),_vm._v(\"=\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'json'\")]),_vm._v(\" -p=\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'[{\\\"op\\\": \\\"replace\\\", \\\"path\\\": \\\"/spec/template/spec/containers/0/image\\\", \\\"value\\\":\\\"quay.io/centos7/postgresql-13-centos7\\\"}]'\")]),_vm._v(\"\\n\")])]),_c('p',[_vm._v(\"Again postgresql pod will crash with the following error\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"Incompatible data directory. This container image provides\\nPostgreSQL \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'13'\")]),_vm._v(\", but data directory is of\\nversion \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'12'\")]),_vm._v(\".\\nThis image supports automatic data directory upgrade from\\n\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'12'\")]),_vm._v(\", please _carefully_ consult image documentation\\nabout how to use the \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'$POSTGRESQL_UPGRADE'\")]),_vm._v(\" startup option.\\n\")])]),_c('p',[_vm._v(\"set the environment variable with the following command\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"oc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"set\")]),_vm._v(\" env dc/postgresql -n postgresql-test POSTGRESQL_UPGRADE=copy\\n\")])]),_c('p',[_vm._v(\"This will cause another roll out.\")]),_c('p',[_vm._v(\"Again you need to unset the \"),_c('code',{pre:true},[_vm._v(\"$POSTGRESQL_UPGRADE\")]),_vm._v(\" env var to avoid issues on future roll outs\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_vm._v(\"oc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"set\")]),_vm._v(\" env dc/system-postgresql -n postgresql-test POSTGRESQL_UPGRADE-\\n\")])]),_c('p',[_vm._v(\"This will cause another roll out and that will be stable with v13 installed.\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\",\"class\":\"language-bash\"}},[_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# run a postgres -v on the none deployment pod for posgres\")]),_vm._v(\"\\noc \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-built_in\"}},[_vm._v(\"exec\")]),_vm._v(\" -it $(oc get po --all-namespaces | grep \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"\\\"postgresql-\\\"\")]),_vm._v(\" | awk \"),_c('span',{pre:true,attrs:{\"class\":\"hljs-string\"}},[_vm._v(\"'{print $2}'\")]),_vm._v(\" | grep -wv deploy) -n postgresql-test -- postgres -V\\n\"),_c('span',{pre:true,attrs:{\"class\":\"hljs-comment\"}},[_vm._v(\"# should give you the version\")]),_vm._v(\"\\npostgres (PostgreSQL) 13.3\\n\")])]),_c('p',[_vm._v(\"All in all it took 7 changes to the deploymentConfig to successfully upgrade.\")])])}]\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./openshiftpostgresql.md?vue&type=template&id=820bd798&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}